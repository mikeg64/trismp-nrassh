#
# Tristan makefile
#

SHELL=/bin/sh

cc= cc
FC= /home/ap1vf/hdf5-1.8.7/hdf5/bin/h5pfc
LD= /home/ap1vf/hdf5-1.8.7/hdf5/bin/h5pfc

USER=user_shock

# compiler and linker flags
# for debuggin purposes use these flags: (compiler dependent) 
#-check uninit -check pointers 
#-warn uncalled -warn declarations -ftrapuv -g -warn unused

# flags normaly used for the intel compilers

CUSTOM= -DMPI -DHDF5 -DserIO 
#-DLOCALSCRATCH 
#-DLOCALRESTART
#-DDEBUG
PERFORMANCE= -O3

# flags normaly used for the gcc and gfortran compilers

#CUSTOM= -DMPI -DHDF5 -DserIO  #-DLOCALSCRATCH 
#PERFORMANCE= -O3 -cpp -fno-range-check -ffree-line-length-none

CFLAGS= 
FFLAGS= $(CUSTOM) $(PERFORMANCE)

# Executable name

EXECUTABLE= tristan-mp3d

# Objects

OBJS= system3d.o systemf3d.o par3d.o inputparser3d.o inputparserf3d.o fparser3d.o globaldata3d.o aux3d.o communications3d.o fields3d.o fieldboundaries3d.o particles3d.o domain3d.o $(USER).o output3d.o restart3d.o particles_movedeposit3d.o overload3d.o initialize3d.o tristanmainloop3d.o tristan3d.o

###########################

all: $(EXECUTABLE)

%3d.o:%.c
	$(cc) $(CFLAGS) $(INCPATH) -c $^ -o $@

%3d.o:%.F90
	$(FC) $(FFLAGS) $(INCPATH) -c $^ -o $@

$(EXECUTABLE): $(OBJS)
	$(FC) $(FFLAGS) -o $@ $(OBJS)
	tar -cf code.tar *.c *.F90 Makefile Makefile3D

clean: 
	rm -f $(OBJS)
	rm -f *.mod
	rm -f $(EXECUTABLE)
	rm -f code.tar
